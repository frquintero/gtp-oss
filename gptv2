#!/bin/bash
"""
# Lightweight launcher for the project as `gptv2`.
# This script mirrors the behavior of the existing `gpt` launcher but
# with a single clean shebang and no duplicated sections.
"""
# Get the directory where this script is located
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

# Prefer virtualenv python if available
if [ -f "$DIR/.venv/bin/python" ]; then
    PYTHON="$DIR/.venv/bin/python"
else
    PYTHON="python3"
fi

cd "$DIR" || exit 1

# Quick mode detection: arguments that are not long-form flags
QUICK_MODE=false
for arg in "$@"; do
    if [[ ! "$arg" =~ ^-- ]]; then
        QUICK_MODE=true
        break
    fi
done

# respect --no-clear flag or GPT_CLEAR_ON_START env var
NO_CLEAR=false
for arg in "$@"; do
    if [ "$arg" = "--no-clear" ]; then
        NO_CLEAR=true
        break
    fi
done
if [ -n "${GPT_CLEAR_ON_START}" ]; then
    case "${GPT_CLEAR_ON_START}" in
        0|false|False|FALSE)
            NO_CLEAR=true
            ;;
    esac
fi

if [ -t 1 ] && [ "$QUICK_MODE" = false ] && [ "$NO_CLEAR" = false ]; then
    clear
    export GPT_ALREADY_CLEARED=1
fi

# Launch the Python entrypoint
exec "$PYTHON" gpt.py "$@"
